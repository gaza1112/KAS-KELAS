<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Buku Kas Kelas - X-L</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .btn-day.active {
            background-color: #16A34A; /* green-600 */
            color: white;
            font-weight: 600;
            border-color: #16A34A;
        }
        .btn-day {
            transition: all 0.2s ease-in-out;
        }
        .student-entry {
            transition: background-color 0.3s ease;
            cursor: pointer;
        }
        .modal-backdrop {
            transition: opacity 0.3s ease;
        }
        select {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%239ca3af' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 0.5rem center;
            background-repeat: no-repeat;
            background-size: 1.5em 1.5em;
            padding-right: 2.5rem;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-200">

    <!-- Login View -->
    <div id="login-view" class="min-h-screen flex items-center justify-center p-4">
        <div class="w-full max-w-sm bg-gray-800 p-8 rounded-2xl shadow-lg border border-gray-700">
            <div class="text-center mb-8">
                <h1 class="text-2xl font-bold text-blue-400">Login Admin Kas Kelas</h1>
                <p class="text-gray-400">Silakan masuk untuk melanjutkan</p>
            </div>
            <form id="login-form">
                <div class="mb-4">
                    <label for="username" class="block text-sm font-medium text-gray-300 mb-1">Username</label>
                    <input type="text" id="username" class="w-full px-4 py-2 border bg-gray-700 border-gray-600 text-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500" required>
                </div>
                <div class="mb-6">
                    <label for="password" class="block text-sm font-medium text-gray-300 mb-1">Password</label>
                    <input type="password" id="password" class="w-full px-4 py-2 border bg-gray-700 border-gray-600 text-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500" required>
                </div>
                <p id="login-error" class="text-red-400 text-sm text-center mb-4 h-5"></p>
                <button type="submit" class="w-full bg-blue-600 text-white font-bold py-3 rounded-lg hover:bg-blue-700 transition-colors">
                    Masuk
                </button>
            </form>
        </div>
    </div>

    <!-- App View -->
    <div id="app-view" class="hidden">
        <div class="container mx-auto max-w-lg p-4 min-h-screen bg-gray-800">
            <header class="text-center py-4 border-b-2 border-gray-700">
                <h1 class="text-3xl font-bold text-blue-400">KAS KELAS X-L</h1>
                <p class="text-gray-400 mt-1">Pencatat Keuangan Kelas</p>
            </header>

            <div class="my-4 p-4 bg-gray-900/70 rounded-lg shadow">
                 <div class="grid grid-cols-2 gap-4 mb-4">
                    <div>
                        <label for="month-select" class="block text-sm font-medium text-gray-300 mb-1">Bulan</label>
                        <select id="month-select" class="w-full px-3 py-2 border bg-gray-700 border-gray-600 text-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500"></select>
                    </div>
                    <div>
                        <label for="week-select" class="block text-sm font-medium text-gray-300 mb-1">Minggu</label>
                        <select id="week-select" class="w-full px-3 py-2 border bg-gray-700 border-gray-600 text-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500">
                            <option value="1">Minggu 1</option>
                            <option value="2">Minggu 2</option>
                            <option value="3">Minggu 3</option>
                            <option value="4">Minggu 4</option>
                        </select>
                    </div>
                </div>
                <div id="summary" class="text-center border-t border-gray-700 pt-4">
                    <p class="text-lg">Kas Terkumpul (Minggu Ini):</p>
                    <p id="total-kas" class="text-4xl font-bold text-green-400">Rp 0</p>
                    <p id="paid-summary" class="text-gray-400 mt-1">0 dari 36 siswa telah membayar.</p>
                </div>
                <div class="mt-4">
                    <p class="text-center font-semibold mb-2">Pilih Hari Pembayaran:</p>
                    <div class="grid grid-cols-2 gap-2">
                        <button id="btn-selasa" class="btn-day w-full py-2 px-4 rounded-lg border border-gray-600 bg-gray-700 hover:bg-gray-600">Selasa</button>
                        <button id="btn-jumat" class="btn-day w-full py-2 px-4 rounded-lg border border-gray-600 bg-gray-700 hover:bg-gray-600">Jumat</button>
                    </div>
                </div>
            </div>

            <main>
                <div id="student-list" class="space-y-2">
                    <!-- Student entries will be generated by JavaScript -->
                </div>
            </main>

            <footer class="mt-6 text-center space-y-4">
                 <div class="flex justify-center gap-4 flex-wrap">
                    <button id="tambah-donasi-button" class="bg-teal-500 text-white font-semibold py-2 px-6 rounded-lg hover:bg-teal-600 transition-colors">
                        Tambah Donasi
                    </button>
                    <button id="tambah-pengeluaran-button" class="bg-yellow-500 text-white font-semibold py-2 px-6 rounded-lg hover:bg-yellow-600 transition-colors">
                        Tambah Pengeluaran
                    </button>
                    <button id="total-kas-button" class="bg-indigo-600 text-white font-semibold py-2 px-6 rounded-lg hover:bg-indigo-700 transition-colors">
                        Total Keseluruhan
                    </button>
                    <button id="download-button" class="bg-green-600 text-white font-semibold py-2 px-6 rounded-lg hover:bg-green-700 transition-colors">
                        Download Laporan
                    </button>
                 </div>
                 <p class="text-xs text-gray-600 pt-2">sing gae gaza cok.</p>
            </footer>
        </div>
    </div>
    
    <!-- Modals -->
    <div id="pengeluaran-modal" class="fixed inset-0 bg-black bg-opacity-50 modal-backdrop flex items-center justify-center p-4 hidden">
        <div class="bg-gray-800 border border-gray-700 rounded-lg shadow-xl p-6 w-full max-w-sm">
            <h3 class="text-lg font-bold text-center">Catat Pengeluaran Baru</h3>
            <form id="pengeluaran-form">
                <div class="mt-4">
                    <label for="pengeluaran-keterangan" class="block text-sm font-medium text-gray-300 mb-1">Keterangan</label>
                    <input type="text" id="pengeluaran-keterangan" placeholder="Contoh: Beli spidol papan tulis" class="w-full px-4 py-2 border bg-gray-700 border-gray-600 text-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500" required>
                </div>
                <div class="mt-4">
                    <label for="pengeluaran-jumlah" class="block text-sm font-medium text-gray-300 mb-1">Jumlah (Rp)</label>
                    <input type="number" id="pengeluaran-jumlah" placeholder="Contoh: 15000" class="w-full px-4 py-2 border bg-gray-700 border-gray-600 text-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500" required>
                </div>
                <div class="flex justify-end gap-3 mt-6">
                    <button type="button" id="batal-pengeluaran" class="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-500">Batal</button>
                    <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">Simpan</button>
                </div>
            </form>
        </div>
    </div>

    <div id="donasi-modal" class="fixed inset-0 bg-black bg-opacity-50 modal-backdrop flex items-center justify-center p-4 hidden">
        <div class="bg-gray-800 border border-gray-700 rounded-lg shadow-xl p-6 w-full max-w-sm">
            <h3 class="text-lg font-bold text-center">Catat Donasi Baru</h3>
            <form id="donasi-form">
                <div class="mt-4">
                    <label for="donasi-jumlah" class="block text-sm font-medium text-gray-300 mb-1">Jumlah (Rp)</label>
                    <input type="number" id="donasi-jumlah" placeholder="Contoh: 50000" class="w-full px-4 py-2 border bg-gray-700 border-gray-600 text-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500" required>
                </div>
                <div class="flex justify-end gap-3 mt-6">
                    <button type="button" id="batal-donasi" class="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-500">Batal</button>
                    <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">Simpan</button>
                </div>
            </form>
        </div>
    </div>

    <div id="total-kas-modal" class="fixed inset-0 bg-black bg-opacity-50 modal-backdrop flex items-center justify-center p-4 hidden">
        <div class="bg-gray-800 border border-gray-700 rounded-lg shadow-xl p-6 w-full max-w-md text-center">
            <h3 class="text-lg font-bold text-blue-400">Rangkuman Kas Keseluruhan</h3>
            <div class="text-left mt-4 space-y-2">
                <div class="flex justify-between items-center">
                    <span class="text-gray-400">Total Pemasukan Kas:</span>
                    <span id="display-pemasukan" class="font-semibold text-green-400 text-lg">Rp 0</span>
                </div>
                 <div class="flex justify-between items-center">
                    <span class="text-gray-400">Total Pemasukan Donasi:</span>
                    <span id="display-donasi" class="font-semibold text-teal-400 text-lg">Rp 0</span>
                </div>
                <div class="flex justify-between items-center">
                    <span class="text-gray-400">Total Pengeluaran:</span>
                    <span id="display-pengeluaran" class="font-semibold text-red-400 text-lg">Rp 0</span>
                </div>
            </div>
            <hr class="border-gray-600 my-3">
            <p class="text-gray-300 text-xl">Saldo Akhir:</p>
            <p class="text-5xl font-bold text-blue-400 my-2" id="display-saldo-akhir">Rp 0</p>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-6 text-left">
                <div>
                    <h4 class="font-semibold mb-2">Rincian Donasi:</h4>
                    <div id="rincian-donasi-list" class="max-h-32 overflow-y-auto space-y-2 pr-2"></div>
                </div>
                <div>
                    <h4 class="font-semibold mb-2">Rincian Pengeluaran:</h4>
                    <div id="rincian-pengeluaran-list" class="max-h-32 overflow-y-auto space-y-2 pr-2"></div>
                </div>
            </div>

            <div class="flex justify-center mt-6">
                <button id="close-total-kas-modal" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">Tutup</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const loginView = document.getElementById('login-view');
            const appView = document.getElementById('app-view');
            const loginForm = document.getElementById('login-form');
            const loginError = document.getElementById('login-error');

            const STUDENT_LIST = [
                "Achmad Ilham", "Alvia Eren Istiqomah", "Ananda Ridho Aditama", "Amelia Dewi Maharani",
                "Angelita Aura Aprilia", "Anisa Nurul Aini", "Arifa Intan Nurlatif", "Aurellia Tungga Dewi",
                "Azzahra Putri Amira", "Cindy Intan Hadi Saputri", "Dhea Agusfina Al Warois",
                "Dhimas Satrio Kurniawan", "Farih Naura Asfiya", "Gaza Tanziilal Furqon",
                "Gista Nazuilla Armeli", "Intan Putri Agustina", "Irsya Nur Nazha", "Janice Vania",
                "Kanaya Anyhania Ramadhani", "Keyza Putri Ramadhani", "Laura Imalia Putri",
                "Lucky Leyva Lee Young Chu Jun", "Mochamad Akbar Saifudin Zuhri", "Muhamad Farhan Al Kafi",
                "Muhammad Nikko Setya Pratama", "Mutiara Nur Laili", "Nabilla Nois Raya Putri Setiawan",
                "Nandita Aulia", "Natasya Dewi", "Nia Avrillia", "Nicky Leyva Lee Young Chu Jun",
                "Nur Amira Triana Ikhsanty", "Risza Aulia Ainul Fitri", "Robana Qusnul Joelia",
                "Saecar Labib Kanhaya Siswanto", "Syevi Citrahrotunisa"
            ];
            const KAS_AMOUNT = 2000;
            const STORAGE_KEY = 'kasKelasXLData';

            // DOM Elements
            const studentListContainer = document.getElementById('student-list');
            const totalKasEl = document.getElementById('total-kas');
            const paidSummaryEl = document.getElementById('paid-summary');
            const btnSelasa = document.getElementById('btn-selasa');
            const btnJumat = document.getElementById('btn-jumat');
            const monthSelect = document.getElementById('month-select');
            const weekSelect = document.getElementById('week-select');

            // Buttons
            const downloadButton = document.getElementById('download-button');
            const totalKasButton = document.getElementById('total-kas-button');
            const tambahPengeluaranButton = document.getElementById('tambah-pengeluaran-button');
            const tambahDonasiButton = document.getElementById('tambah-donasi-button');

            // Modals
            const pengeluaranModal = document.getElementById('pengeluaran-modal');
            const donasiModal = document.getElementById('donasi-modal');
            const totalKasModal = document.getElementById('total-kas-modal');

            // Forms & Modal Controls
            const pengeluaranForm = document.getElementById('pengeluaran-form');
            const donasiForm = document.getElementById('donasi-form');
            const batalPengeluaranButton = document.getElementById('batal-pengeluaran');
            const batalDonasiButton = document.getElementById('batal-donasi');
            const closeTotalKasModal = document.getElementById('close-total-kas-modal');

            // Display elements in Total Modal
            const displayPemasukan = document.getElementById('display-pemasukan');
            const displayDonasi = document.getElementById('display-donasi');
            const displayPengeluaran = document.getElementById('display-pengeluaran');
            const displaySaldoAkhir = document.getElementById('display-saldo-akhir');
            const rincianDonasiList = document.getElementById('rincian-donasi-list');
            const rincianPengeluaranList = document.getElementById('rincian-pengeluaran-list');
            
            let currentDay = 'selasa';
            let allData = { kasData: {}, expenses: [], donations: [] };

            // --- Login Logic ---
            loginForm.addEventListener('submit', (e) => {
                e.preventDefault();
                if (document.getElementById('username').value === 'gaza74' && document.getElementById('password').value === 'gaza74') {
                    loginError.textContent = '';
                    loginView.classList.add('hidden');
                    appView.classList.remove('hidden');
                    initializeApp();
                } else {
                    loginError.textContent = 'Username atau password salah.';
                }
            });

            // --- Data Handling Functions ---
            function loadAllData() {
                const dataString = localStorage.getItem(STORAGE_KEY);
                const loadedData = dataString ? JSON.parse(dataString) : { kasData: {}, expenses: [], donations: [] };
                if (!loadedData.kasData) loadedData.kasData = {};
                if (!loadedData.expenses) loadedData.expenses = [];
                if (!loadedData.donations) loadedData.donations = [];
                return loadedData;
            }

            function saveData() {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(allData));
            }

            function getDataForCurrentPeriod() {
                const periodKey = `${monthSelect.value}-${weekSelect.value}`;
                if (!allData.kasData[periodKey]) {
                    const initialData = {};
                    STUDENT_LIST.forEach((name, index) => {
                        initialData[`student_${index}`] = { name, selasa: false, jumat: false };
                    });
                    allData.kasData[periodKey] = initialData;
                    saveData();
                }
                return allData.kasData[periodKey];
            }

            // --- UI Functions ---
            function populateMonthSelector() {
                const months = ["Januari", "Februari", "Maret", "April", "Mei", "Juni", "Juli", "Agustus", "September", "Oktober", "November", "Desember"];
                const startYear = 2025;
                const endYear = 2026;
                monthSelect.innerHTML = '';
                for (let i = 6; i < 12; i++) {
                    const option = document.createElement('option');
                    option.value = `${startYear}-${i + 1}`;
                    option.textContent = `${months[i]} ${startYear}`;
                    monthSelect.appendChild(option);
                }
                for (let i = 0; i <= 6; i++) {
                    const option = document.createElement('option');
                    option.value = `${endYear}-${i + 1}`;
                    option.textContent = `${months[i]} ${endYear}`;
                    monthSelect.appendChild(option);
                }
            }

            function render() {
                const studentData = getDataForCurrentPeriod();
                studentListContainer.innerHTML = '';
                Object.keys(studentData).forEach((studentId, index) => {
                    const data = studentData[studentId];
                    const hasPaid = data[currentDay];
                    const entry = document.createElement('div');
                    entry.className = `student-entry flex items-center justify-between p-3 rounded-lg shadow-sm ${hasPaid ? 'bg-green-500/10 text-green-300' : 'bg-red-500/10 text-red-300'}`;
                    entry.dataset.id = studentId;

                    const studentName = document.createElement('span');
                    studentName.className = 'font-medium';
                    studentName.textContent = `${index + 1}. ${data.name}`;

                    const status = document.createElement('span');
                    status.className = `font-bold text-sm px-2 py-1 rounded-full ${hasPaid ? 'bg-green-500/20' : 'bg-red-500/20'}`;
                    status.textContent = hasPaid ? 'LUNAS' : 'BELUM';
                    
                    entry.appendChild(studentName);
                    entry.appendChild(status);
                    entry.addEventListener('click', () => togglePayment(studentId));
                    studentListContainer.appendChild(entry);
                });
                updateSummary();
                updateActiveDayButton();
            }

            function updateSummary() {
                const studentData = getDataForCurrentPeriod();
                const paidCount = Object.values(studentData).filter(s => s[currentDay]).length;
                const total = paidCount * KAS_AMOUNT;
                totalKasEl.textContent = `Rp ${total.toLocaleString('id-ID')}`;
                paidSummaryEl.textContent = `${paidCount} dari ${STUDENT_LIST.length} siswa telah membayar.`;
            }

            function updateActiveDayButton() {
                btnSelasa.classList.toggle('active', currentDay === 'selasa');
                btnJumat.classList.toggle('active', currentDay === 'jumat');
            }
            
            // --- Event Handlers & Actions ---
            function togglePayment(studentId) {
                const studentData = getDataForCurrentPeriod();
                studentData[studentId][currentDay] = !studentData[studentId][currentDay];
                saveData();
                render();
            }

            function handleExpenseSubmit(e) {
                e.preventDefault();
                const keterangan = document.getElementById('pengeluaran-keterangan').value;
                const jumlah = parseInt(document.getElementById('pengeluaran-jumlah').value);
                if (keterangan && jumlah > 0) {
                    allData.expenses.push({ keterangan, jumlah, tanggal: new Date().toISOString() });
                    saveData();
                    pengeluaranForm.reset();
                    pengeluaranModal.classList.add('hidden');
                }
            }
            
            function handleDonationSubmit(e) {
                e.preventDefault();
                const jumlah = parseInt(document.getElementById('donasi-jumlah').value);
                if (jumlah > 0) {
                    allData.donations.push({ keterangan: "Donasi", jumlah, tanggal: new Date().toISOString() });
                    saveData();
                    donasiForm.reset();
                    donasiModal.classList.add('hidden');
                }
            }
            
            function deleteTransaction(type, tanggal) {
                allData[type] = allData[type].filter(item => item.tanggal !== tanggal);
                saveData();
                calculateAndShowTotalKas(); // Refresh the modal view
            }

            function calculateAndShowTotalKas() {
                let totalPemasukan = 0;
                for (const periodKey in allData.kasData) {
                    const periodData = allData.kasData[periodKey];
                    for (const studentId in periodData) {
                        const student = periodData[studentId];
                        if (student.selasa) totalPemasukan += KAS_AMOUNT;
                        if (student.jumat) totalPemasukan += KAS_AMOUNT;
                    }
                }

                let totalDonasi = 0;
                rincianDonasiList.innerHTML = '';
                if (allData.donations.length === 0) {
                    rincianDonasiList.innerHTML = '<p class="text-gray-500">Belum ada donasi.</p>';
                } else {
                    allData.donations.forEach(donasi => {
                        totalDonasi += donasi.jumlah;
                        createTransactionItem(rincianDonasiList, donasi, 'donations');
                    });
                }

                let totalPengeluaran = 0;
                rincianPengeluaranList.innerHTML = '';
                if (allData.expenses.length === 0) {
                    rincianPengeluaranList.innerHTML = '<p class="text-gray-500">Belum ada pengeluaran.</p>';
                } else {
                    allData.expenses.forEach(expense => {
                        totalPengeluaran += expense.jumlah;
                        createTransactionItem(rincianPengeluaranList, expense, 'expenses');
                    });
                }

                const saldoAkhir = (totalPemasukan + totalDonasi) - totalPengeluaran;

                displayPemasukan.textContent = `Rp ${totalPemasukan.toLocaleString('id-ID')}`;
                displayDonasi.textContent = `Rp ${totalDonasi.toLocaleString('id-ID')}`;
                displayPengeluaran.textContent = `Rp ${totalPengeluaran.toLocaleString('id-ID')}`;
                displaySaldoAkhir.textContent = `Rp ${saldoAkhir.toLocaleString('id-ID')}`;
                totalKasModal.classList.remove('hidden');
            }

            function createTransactionItem(listElement, itemData, type) {
                const item = document.createElement('div');
                item.className = 'flex justify-between items-center bg-gray-700 p-2 rounded';
                
                const details = document.createElement('div');
                details.className = 'text-left';
                details.innerHTML = `<span class="font-medium">${itemData.keterangan}</span><br><span class="text-xs text-gray-400">Rp ${itemData.jumlah.toLocaleString('id-ID')}</span>`;
                
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'text-red-400 hover:text-red-300 p-1';
                deleteBtn.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm4 0a1 1 0 012 0v6a1 1 0 11-2 0V8z" clip-rule="evenodd" /></svg>`;
                deleteBtn.onclick = () => deleteTransaction(type, itemData.tanggal);

                item.appendChild(details);
                item.appendChild(deleteBtn);
                listElement.appendChild(item);
            }

            function downloadReport() {
                let reportContent = `Laporan Kas Kelas X-L Keseluruhan\n========================================\nLaporan dibuat pada: ${new Date().toLocaleString('id-ID')}\n\n`;

                let totalPemasukan = 0;
                for (const periodKey in allData.kasData) {
                    const periodData = allData.kasData[periodKey];
                    for (const studentId in periodData) {
                        const student = periodData[studentId];
                        if (student.selasa) totalPemasukan += KAS_AMOUNT;
                        if (student.jumat) totalPemasukan += KAS_AMOUNT;
                    }
                }
                
                let totalDonasi = 0;
                allData.donations.forEach(d => totalDonasi += d.jumlah);
                let totalPengeluaran = 0;
                allData.expenses.forEach(e => totalPengeluaran += e.jumlah);
                const saldoAkhir = (totalPemasukan + totalDonasi) - totalPengeluaran;

                reportContent += `--- RANGKUMAN KEUANGAN ---\n`;
                reportContent += `Total Pemasukan Kas  : Rp ${totalPemasukan.toLocaleString('id-ID')}\n`;
                reportContent += `Total Pemasukan Donasi: Rp ${totalDonasi.toLocaleString('id-ID')}\n`;
                reportContent += `Total Pengeluaran    : Rp ${totalPengeluaran.toLocaleString('id-ID')}\n`;
                reportContent += `Saldo Akhir          : Rp ${saldoAkhir.toLocaleString('id-ID')}\n\n`;
                
                reportContent += `--- RINCIAN DONASI ---\n`;
                if (allData.donations.length > 0) {
                    allData.donations.forEach(d => {
                        const tgl = new Date(d.tanggal).toLocaleDateString('id-ID');
                        reportContent += `- ${tgl}: ${d.keterangan.padEnd(30, ' ')} (Rp ${d.jumlah.toLocaleString('id-ID')})\n`;
                    });
                } else {
                    reportContent += `Tidak ada donasi.\n`;
                }
                reportContent += `\n`;

                reportContent += `--- RINCIAN PENGELUARAN ---\n`;
                if (allData.expenses.length > 0) {
                    allData.expenses.forEach(e => {
                        const tgl = new Date(e.tanggal).toLocaleDateString('id-ID');
                        reportContent += `- ${tgl}: ${e.keterangan.padEnd(30, ' ')} (Rp ${e.jumlah.toLocaleString('id-ID')})\n`;
                    });
                } else {
                    reportContent += `Tidak ada pengeluaran.\n`;
                }
                
                const blob = new Blob([reportContent], { type: 'text/plain;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `laporan-kas-keseluruhan-X-L.txt`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }

            // --- Initialization ---
            function initializeApp() {
                allData = loadAllData();
                populateMonthSelector();
                monthSelect.value = '2025-7';
                weekSelect.value = '3';

                // Event Listeners
                monthSelect.addEventListener('change', render);
                weekSelect.addEventListener('change', render);
                btnSelasa.addEventListener('click', () => { currentDay = 'selasa'; render(); });
                btnJumat.addEventListener('click', () => { currentDay = 'jumat'; render(); });
                
                downloadButton.addEventListener('click', downloadReport);
                totalKasButton.addEventListener('click', calculateAndShowTotalKas);
                tambahPengeluaranButton.addEventListener('click', () => pengeluaranModal.classList.remove('hidden'));
                tambahDonasiButton.addEventListener('click', () => donasiModal.classList.remove('hidden'));
                
                pengeluaranForm.addEventListener('submit', handleExpenseSubmit);
                batalPengeluaranButton.addEventListener('click', () => pengeluaranModal.classList.add('hidden'));
                donasiForm.addEventListener('submit', handleDonationSubmit);
                batalDonasiButton.addEventListener('click', () => donasiModal.classList.add('hidden'));
                closeTotalKasModal.addEventListener('click', () => totalKasModal.classList.add('hidden'));

                render();
            }
        });
    </script>
</body>
</html>
