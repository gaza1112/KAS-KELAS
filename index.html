<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Buku Kas Kelas - X-L</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .btn-day.active {
            background-color: #16A34A; /* green-600 */
            color: white;
            font-weight: 600;
            border-color: #16A34A;
        }
        .btn-day {
            transition: all 0.2s ease-in-out;
        }
        .student-entry {
            transition: background-color 0.3s ease;
            cursor: pointer;
        }
        .modal-backdrop {
            transition: opacity 0.3s ease;
        }
        select {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%239ca3af' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 0.5rem center;
            background-repeat: no-repeat;
            background-size: 1.5em 1.5em;
            padding-right: 2.5rem;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-200">

    <!-- App View -->
    <div id="app-view">
        <div class="container mx-auto max-w-lg p-4 min-h-screen bg-gray-800">
            <header class="text-center py-4 border-b-2 border-gray-700">
                <h1 class="text-3xl font-bold text-blue-400">KAS KELAS X-L</h1>
                <p class="text-gray-400 mt-1">Pencatat Keuangan Kelas</p>
            </header>

            <div class="my-4 p-4 bg-gray-900/70 rounded-lg shadow">
                 <div class="grid grid-cols-2 gap-4 mb-4">
                    <div>
                        <label for="month-select" class="block text-sm font-medium text-gray-300 mb-1">Bulan</label>
                        <select id="month-select" class="w-full px-3 py-2 border bg-gray-700 border-gray-600 text-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500"></select>
                    </div>
                    <div>
                        <label for="week-select" class="block text-sm font-medium text-gray-300 mb-1">Minggu</label>
                        <select id="week-select" class="w-full px-3 py-2 border bg-gray-700 border-gray-600 text-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500">
                            <option value="1">Minggu 1</option>
                            <option value="2">Minggu 2</option>
                            <option value="3">Minggu 3</option>
                            <option value="4">Minggu 4</option>
                        </select>
                    </div>
                </div>
                <div id="summary" class="text-center border-t border-gray-700 pt-4">
                    <p class="text-lg">Kas Terkumpul (Minggu Ini):</p>
                    <p id="total-kas" class="text-4xl font-bold text-green-400">Rp 0</p>
                    <p id="paid-summary" class="text-gray-400 mt-1">0 dari 36 siswa telah membayar.</p>
                </div>
                <div class="mt-4">
                    <p class="text-center font-semibold mb-2">Pilih Hari Pembayaran:</p>
                    <div class="grid grid-cols-2 gap-2">
                        <button id="btn-selasa" class="btn-day w-full py-2 px-4 rounded-lg border border-gray-600 bg-gray-700 hover:bg-gray-600">Selasa</button>
                        <button id="btn-jumat" class="btn-day w-full py-2 px-4 rounded-lg border border-gray-600 bg-gray-700 hover:bg-gray-600">Jumat</button>
                    </div>
                </div>
            </div>

            <main>
                <div id="student-list" class="space-y-2">
                    <!-- Student entries will be generated by JavaScript -->
                </div>
            </main>

            <footer class="mt-6 text-center">
                 <div class="flex justify-center gap-4">
                    <button id="download-button" class="bg-green-600 text-white font-semibold py-2 px-6 rounded-lg hover:bg-green-700 transition-colors">
                        Download Laporan
                    </button>
                    <button id="reset-button" class="bg-red-600 text-white font-semibold py-2 px-6 rounded-lg hover:bg-red-700 transition-colors">
                        Reset Minggu Ini
                    </button>
                 </div>
            </footer>
        </div>
    </div>
    
    <div id="reset-modal" class="fixed inset-0 bg-black bg-opacity-50 modal-backdrop flex items-center justify-center p-4 hidden">
        <div class="bg-gray-800 border border-gray-700 rounded-lg shadow-xl p-6 w-full max-w-sm">
            <h3 class="text-lg font-bold text-center">Konfirmasi Reset</h3>
            <p class="text-center text-gray-300 my-4">Yakin ingin mereset data pembayaran untuk minggu ini? Tindakan ini tidak dapat dibatalkan.</p>
            <div class="flex justify-end gap-3 mt-6">
                <button id="cancel-reset" class="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-500">Batal</button>
                <button id="confirm-reset" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700">Ya, Reset</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const STUDENT_LIST = [
                "Achmad Ilham", "Alvia Eren Istiqomah", "Ananda Ridho Aditama", "Amelia Dewi Maharani",
                "Angelita Aura Aprilia", "Anisa Nurul Aini", "Arifa Intan Nurlatif", "Aurellia Tungga Dewi",
                "Azzahra Putri Amira", "Cindy Intan Hadi Saputri", "Dhea Agusfina Al Warois",
                "Dhimas Satrio Kurniawan", "Farih Naura Asfiya", "Gaza Tanziilal Furqon",
                "Gista Nazuilla Armeli", "Intan Putri Agustina", "Irsya Nur Nazha", "Janice Vania",
                "Kanaya Anyhania Ramadhani", "Keyza Putri Ramadhani", "Laura Imalia Putri",
                "Lucky Leyva Lee Young Chu Jun", "Mochamad Akbar Saifudin Zuhri", "Muhamad Farhan Al Kafi",
                "Muhammad Nikko Setya Pratama", "Mutiara Nur Laili", "Nabilla Nois Raya Putri Setiawan",
                "Nandita Aulia", "Natasya Dewi", "Nia Avrillia", "Nicky Leyva Lee Young Chu Jun",
                "Nur Amira Triana Ikhsanty", "Risza Aulia Ainul Fitri", "Robana Qusnul Joelia",
                "Saecar Labib Kanhaya Siswanto", "Syevi Citrahrotunisa"
            ];
            const KAS_AMOUNT = 2000;
            const STORAGE_KEY = 'kasKelasXLData';

            const studentListContainer = document.getElementById('student-list');
            const totalKasEl = document.getElementById('total-kas');
            const paidSummaryEl = document.getElementById('paid-summary');
            const btnSelasa = document.getElementById('btn-selasa');
            const btnJumat = document.getElementById('btn-jumat');
            const resetButton = document.getElementById('reset-button');
            const downloadButton = document.getElementById('download-button');
            const resetModal = document.getElementById('reset-modal');
            const cancelResetButton = document.getElementById('cancel-reset');
            const confirmResetButton = document.getElementById('confirm-reset');
            const monthSelect = document.getElementById('month-select');
            const weekSelect = document.getElementById('week-select');

            let currentDay = 'selasa';
            let allData = {};

            // --- Data Handling Functions ---
            function loadAllData() {
                const dataString = localStorage.getItem(STORAGE_KEY);
                return dataString ? JSON.parse(dataString) : {};
            }

            function saveDataForPeriod(periodKey, data) {
                allData[periodKey] = data;
                localStorage.setItem(STORAGE_KEY, JSON.stringify(allData));
            }

            function getDataForCurrentPeriod() {
                const periodKey = `${monthSelect.value}-${weekSelect.value}`;
                if (!allData[periodKey]) {
                    // Seed data if it doesn't exist for this period
                    const initialData = {};
                    STUDENT_LIST.forEach((name, index) => {
                        initialData[`student_${index}`] = { name, selasa: false, jumat: false };
                    });
                    allData[periodKey] = initialData;
                    saveDataForPeriod(periodKey, allData[periodKey]);
                }
                return allData[periodKey];
            }

            // --- UI Functions ---
            function populateMonthSelector() {
                const months = ["Januari", "Februari", "Maret", "April", "Mei", "Juni", "Juli", "Agustus", "September", "Oktober", "November", "Desember"];
                const startYear = 2025;
                const endYear = 2026;
                monthSelect.innerHTML = '';
                for (let i = 6; i < 12; i++) {
                    const option = document.createElement('option');
                    option.value = `${startYear}-${i + 1}`;
                    option.textContent = `${months[i]} ${startYear}`;
                    monthSelect.appendChild(option);
                }
                for (let i = 0; i <= 6; i++) {
                    const option = document.createElement('option');
                    option.value = `${endYear}-${i + 1}`;
                    option.textContent = `${months[i]} ${endYear}`;
                    monthSelect.appendChild(option);
                }
            }

            function render() {
                const studentData = getDataForCurrentPeriod();
                studentListContainer.innerHTML = '';
                Object.keys(studentData).forEach((studentId, index) => {
                    const data = studentData[studentId];
                    const hasPaid = data[currentDay];
                    const entry = document.createElement('div');
                    entry.className = `student-entry flex items-center justify-between p-3 rounded-lg shadow-sm ${hasPaid ? 'bg-green-500/10 text-green-300' : 'bg-red-500/10 text-red-300'}`;
                    entry.dataset.id = studentId;

                    const studentName = document.createElement('span');
                    studentName.className = 'font-medium';
                    studentName.textContent = `${index + 1}. ${data.name}`;

                    const status = document.createElement('span');
                    status.className = `font-bold text-sm px-2 py-1 rounded-full ${hasPaid ? 'bg-green-500/20' : 'bg-red-500/20'}`;
                    status.textContent = hasPaid ? 'LUNAS' : 'BELUM';
                    
                    entry.appendChild(studentName);
                    entry.appendChild(status);
                    entry.addEventListener('click', () => togglePayment(studentId));
                    studentListContainer.appendChild(entry);
                });
                updateSummary();
                updateActiveDayButton();
            }

            function updateSummary() {
                const studentData = getDataForCurrentPeriod();
                const paidCount = Object.values(studentData).filter(s => s[currentDay]).length;
                const total = paidCount * KAS_AMOUNT;
                totalKasEl.textContent = `Rp ${total.toLocaleString('id-ID')}`;
                paidSummaryEl.textContent = `${paidCount} dari ${STUDENT_LIST.length} siswa telah membayar.`;
            }

            function updateActiveDayButton() {
                btnSelasa.classList.toggle('active', currentDay === 'selasa');
                btnJumat.classList.toggle('active', currentDay === 'jumat');
            }
            
            // --- Event Handlers & Actions ---
            function togglePayment(studentId) {
                const periodKey = `${monthSelect.value}-${weekSelect.value}`;
                const studentData = getDataForCurrentPeriod();
                studentData[studentId][currentDay] = !studentData[studentId][currentDay];
                saveDataForPeriod(periodKey, studentData);
                render();
            }

            function resetCurrentWeekPayments() {
                const periodKey = `${monthSelect.value}-${weekSelect.value}`;
                const studentData = getDataForCurrentPeriod();
                Object.keys(studentData).forEach(studentId => {
                    studentData[studentId].selasa = false;
                    studentData[studentId].jumat = false;
                });
                saveDataForPeriod(periodKey, studentData);
                render();
            }

            function downloadReport() {
                const studentData = getDataForCurrentPeriod();
                const selectedMonthText = monthSelect.options[monthSelect.selectedIndex].text;
                const selectedWeekText = weekSelect.options[weekSelect.selectedIndex].text;
                let reportContent = `Laporan Kas Kelas X-L\n========================================\nPeriode: ${selectedMonthText} - ${selectedWeekText}\n\n`;
                let totalSelasa = 0;
                let totalJumat = 0;
                Object.values(studentData).forEach(student => {
                    if (student.selasa) totalSelasa += KAS_AMOUNT;
                    if (student.jumat) totalJumat += KAS_AMOUNT;
                });
                const grandTotal = totalSelasa + totalJumat;
                reportContent += `Total Kas Terkumpul (Minggu Ini): Rp ${grandTotal.toLocaleString('id-ID')}\n - Selasa: Rp ${totalSelasa.toLocaleString('id-ID')}\n - Jumat: Rp ${totalJumat.toLocaleString('id-ID')}\n\n`;
                reportContent += `--- RINCIAN HARI SELASA ---\n`;
                Object.values(studentData).forEach((data, index) => {
                    const status = data.selasa ? 'LUNAS' : 'BELUM';
                    reportContent += `${(index + 1).toString().padStart(2, ' ')}. ${data.name.padEnd(35, ' ')}: ${status}\n`;
                });
                reportContent += `\n--- RINCIAN HARI JUMAT ---\n`;
                Object.values(studentData).forEach((data, index) => {
                    const status = data.jumat ? 'LUNAS' : 'BELUM';
                    reportContent += `${(index + 1).toString().padStart(2, ' ')}. ${data.name.padEnd(35, ' ')}: ${status}\n`;
                });
                reportContent += `\n\nLaporan dibuat pada: ${new Date().toLocaleString('id-ID')}\n`;
                const blob = new Blob([reportContent], { type: 'text/plain;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `laporan-kas-X-L-${selectedMonthText.replace(/ /g, '-')}-${selectedWeekText.replace(/ /g, '-')}.txt`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }

            // --- Initialization ---
            function initializeApp() {
                allData = loadAllData();
                populateMonthSelector();
                monthSelect.value = '2025-7';
                weekSelect.value = '3';

                monthSelect.addEventListener('change', render);
                weekSelect.addEventListener('change', render);
                btnSelasa.addEventListener('click', () => {
                    currentDay = 'selasa';
                    render();
                });
                btnJumat.addEventListener('click', () => {
                    currentDay = 'jumat';
                    render();
                });
                resetButton.addEventListener('click', () => resetModal.classList.remove('hidden'));
                downloadButton.addEventListener('click', downloadReport);
                cancelResetButton.addEventListener('click', () => resetModal.classList.add('hidden'));
                confirmResetButton.addEventListener('click', () => {
                    resetCurrentWeekPayments();
                    resetModal.classList.add('hidden');
                });

                render();
            }

            initializeApp();
        });
    </script>
</body>
</html>
